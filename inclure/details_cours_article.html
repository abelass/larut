#SET{date,#ARRAY}
#SET{horaire,#ARRAY}
#SET{prix,#ARRAY}
#SET{lieu,#ARRAY}
#SET{id_prix_objet,#ARRAY}
#SET{id_gis,#ARRAY}
#SET{prix_evenement,#ARRAY}
#SET{id_evenement,#ARRAY}
<BOUCLE_rub_res(RUBRIQUES){lang}{composition=reservation}{0,1}{tout}>
    #SET{url_reservation,#URL_RUBRIQUE}
</BOUCLE_rub_res>
    <BOUCLE_rub_res_def(RUBRIQUES){composition=reservation}{0,1}{tout}>
        #SET{url_reservation,#URL_RUBRIQUE}
    </BOUCLE_rub_res_def>
<//B_rub_res>

<BOUCLE_evenement(EVENEMENTS){id_article}{inscription=1}{date_fin>#DATE}{par date_debut}>
    [(#ID_EVENEMENT_SOURCE|=={0}|?{
       #SET{id_evenement,#GET{id_evenement}|push{#ID_EVENEMENT}}   
        #SET{dates_#ID_EVENEMENT,#ARRAY{#COMPTEUR_BOUCLE,#ARRAY{date_debut,#DATE_DEBUT,date_fin,#DATE_FIN}}},
         #SET{dates_#ID_EVENEMENT_SOURCE,#GET{dates_#ID_EVENEMENT_SOURCE}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ARRAY{date_debut,#DATE_DEBUT,date_fin,#DATE_FIN}}}}        
    })]     
    
                       
    #SET{h,#DATE_DEBUT|affdate{H:i}|concat{-#DATE_FIN|affdate{H:i}}}
    [(#GET{h}|in_array{#GET{horaire}}|non)#SET{horaire,#GET{horaire}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#DATE_DEBUT|affdate{H:i}|concat{-#DATE_FIN|affdate{H:i}}}}}]
    #SET{prix_evenement,#ARRAY}
    
    <BOUCLE_prix(PRIX_OBJETS){id_objet=#ID_EVENEMENT}{objet=evenement}{id_prix_objet !IN #GET{id_prix_objet}}{si #ID_EVENEMENT_SOURCE|=={0}|oui}>
        #SET{id_prix_objet,#GET{id_prix_objet}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_PRIX_OBJET}}}
        #SET{prix_evenement,#GET{prix_evenement}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ARRAY{prix,#PRIX,id_declinaison,#ID_DECLINAISON}}}}
    </BOUCLE_prix>
    #SET{prix,#GET{prix}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#GET{prix_evenement}}}} 
    </B_prix> 
    
    <BOUCLE_lieu(GIS){id_evenement}{id_gis !IN #GET{id_gis}}{0,1}>
        #SET{id_gis,#GET{id_gis}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_GIS}}}    
        #SET{lieu,#GET{lieu}|array_merge{#ARRAY{
            #COMPTEUR_BOUCLE,#ARRAY{
                    titre,#TITRE,
                    adresse,#ADRESSE**,
                    code_postal,#CODE_POSTAL,
                    ville,#VILLE
                    }
                  }
               }
           }       
    </BOUCLE_lieu>
</BOUCLE_evenement>

<BOUCLE_prix_art(PRIX_OBJETS){id_objet=#ID_ARTICLE}{objet=article}{si #GET{prix}|count|<{1}|oui}>
        [(#ID_PRIX_OBJET|in_array{#GET{id_prix_objet}}|non)
        #SET{prix_evenement,#GET{prix_evenement}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ARRAY{prix,#PRIX,id_declinaison,#ID_DECLINAISON}}}}
         ]
         #SET{id_prix_objet,#GET{id_prix_objet}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_PRIX_OBJET}}}
</BOUCLE_prix_art>
    #SET{prix,#GET{prix_evenement}} 
 </B_prix_art>
    
<BOUCLE_lieu_art(GIS){id_article}{si #GET{lieu}|count|<{1}} {0,1}>
    #SET{id_gis,#GET{id_gis}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_GIS}}}   
    #SET{lieu,#GET{lieu}|array_merge{#ARRAY{
        #COMPTEUR_BOUCLE,#ARRAY{
                titre,#TITRE,
                adresse,#ADRESSE**,
                code_postal,#CODE_POSTAL,
                ville,#VILLE
                }
              }
           }
       }        
</BOUCLE_lieu_art>


<B_date_resultat> 
#SET{resultat,oui}
<div class="infos_cours">
    <table>    
    <tr>
        <td class="label"><:reservation:label_date:></td>
        <td>
        <ul>
        <BOUCLE_date_resultat(DATA){source tableau,#GET{id_evenement}}>
        <li class="item">
            #SET{compteur,#COMPTEUR_BOUCLE}                
                <B_evs_enfant>
                <div class="entete multi"><:larut:seance:> #GET{compteur}</div>
                <ol>
                     <BOUCLE_evs_enfant(DATA){source tableau,#GET{dates_#VALEUR}}{si #GET{dates_#VALEUR}|count|>{1}|oui}>
                     <li[ (#COMPTEUR_BOUCLE|=={#TOTAL_BOUCLE}|oui)class="last"]>[(#DATE_DEBUT|affdate_jourcourt)]</li>      
                     </BOUCLE_evs_enfant>
                </ol>           
               </B_evs_enfant>
                   <BOUCLE_evs_enfant_alt(DATA){source tableau,#GET{dates_#VALEUR}}>
                    [<div class="entete">(#DATE_DEBUT|affdate_debut_fin{#DATE_FIN,non,abbr})</div>]
                   </BOUCLE_evs_enfant_alt>             
             <//B_evs_enfant>                             
        </li>
        </BOUCLE_date_resultat>
        </ul>   
        </td>
    </tr>
    </B_date_resultat>
    [<tr>
        <td class="label"><:larut:label_horaire:></td>
        <td>(#GET{horaire}|implode{' / '})</td>
    </tr>]
    <B_prix_res>
    <tr>
        <td class="label"><:larut:label_prix:></td>
        <td>
           <BOUCLE_prix_res(DATA){source tableau,#GET{prix}}>
            <div>#VALEUR{prix}
                <B_decl>
                -
                <BOUCLE_decl(DECLINAISONS){id_declinaison=#ID_DECLINAISON}{id_declinaison!=0}>
                #TITRE
                </BOUCLE_decl>                    
            </div>
           </BOUCLE_prix_res>
         </td>
    </B_prix_res>
    </tr>
    <B_lieu_resultat> 
    <tr>
       <td class="label"><:agenda:info_lieu:></td>
       <td>
        <BOUCLE_lieu_resultat(DATA){source tableau,#GET{lieu}}>
        <div class="item">
            [<div class="titre">(#TITRE)</div>]
            [<div class="adresse">(#ADRESSE|extraire_multi)</div>]
            [<div>
                [<span >(#CODE_POSTAL)</span>] <span>(#VILLE)</span>
            </div>]
        </div>
       </BOUCLE_lieu_resultat> 
      </td>    
    </tr>     
    </B_lieu_resultat>
[(#GET{resultat}|oui)                                                  
    </table>
    <a class="btn btn-primary" href="[(#GET{url_reservation}|parametre_url{id_evenement,#GET{id_evenement}})]"><i class="icon-arrow-right icon-white"></i> <:larut:inscription:></a>
</div>]
