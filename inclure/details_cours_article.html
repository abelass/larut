#SET{date,#ARRAY}

#SET{prix,#ARRAY}
#SET{lieu,#ARRAY}
#SET{id_prix_objet,#ARRAY}
#SET{id_gis,#ARRAY}
#SET{prix_evenement,#ARRAY}
#SET{id_evenement,#ARRAY}
#SET{multi,''}
<BOUCLE_evenement(EVENEMENTS){id_article}{inscription=1}{date_debut>#DATE}{par date_debut}>
    [(#ID_EVENEMENT_SOURCE|=={0}|?{
       #SET{id_evenement,#GET{id_evenement}|push{#ID_EVENEMENT}} 
       #SET{horaire,#DATE_DEBUT|affdate{H:i}|concat{-#DATE_FIN|affdate{H:i}}}
       #SET{dates_#ID_EVENEMENT,#ARRAY{#COMPTEUR_BOUCLE,#ARRAY{
            date_debut,#DATE_DEBUT,
            date_fin,#DATE_FIN,
            id_source,#ID_EVENEMENT_SOURCE,
            horaire,#GET{horaire},
			places,#PLACES            
            }}}
        ,
    	[(#GET{dates_#ID_EVENEMENT_SOURCE}|is_array|oui)
	        [(#GET{horaire}|non)
		    	[(#SET{horaire,#DATE_DEBUT|affdate{H:i}|concat{-#DATE_FIN|affdate{H:i}}})]
		    	]    	
        	#SET{dates_#ID_EVENEMENT_SOURCE,#GET{dates_#ID_EVENEMENT_SOURCE}|array_merge{#ARRAY{
            #COMPTEUR_BOUCLE,#ARRAY{
                date_debut,#DATE_DEBUT,
                date_fin,#DATE_FIN,
                horaire,#GET{horaire},
                id_source,#ID_EVENEMENT_SOURCE}}}}
                ]    
    	})]     
           
    #SET{prix_evenement,#ARRAY}
    
    <BOUCLE_prix(PRIX_OBJETS){id_objet=#ID_EVENEMENT}{objet=evenement}{id_prix_objet !IN #GET{id_prix_objet}}{si #ID_EVENEMENT_SOURCE|=={0}|oui}>
        #SET{id_prix_objet,#GET{id_prix_objet}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_PRIX_OBJET}}}
        #SET{prix_evenement,#GET{prix_evenement}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ARRAY{prix,#PRIX,id_declinaison,#ID_DECLINAISON}}}}
    </BOUCLE_prix>
    #SET{prix,#GET{prix}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#GET{prix_evenement}}}} 
    </B_prix> 
    
    <BOUCLE_lieu(GIS){id_evenement}{id_gis !IN #GET{id_gis}}{0,1}>
        #SET{id_gis,#GET{id_gis}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_GIS}}}    
        #SET{lieu,#GET{lieu}|array_merge{#ARRAY{
            #COMPTEUR_BOUCLE,#ARRAY{
                    titre,#TITRE,
                    adresse,#ADRESSE**,
                    code_postal,#CODE_POSTAL,
                    ville,#VILLE
                    }
                  }
               }
           }       
    </BOUCLE_lieu>
</BOUCLE_evenement>

<BOUCLE_prix_art(PRIX_OBJETS){id_objet=#ID_ARTICLE}{objet=article}{si #GET{prix}|count|<{1}|oui}>
        [(#ID_PRIX_OBJET|in_array{#GET{id_prix_objet}}|non)
        #SET{prix_evenement,#GET{prix_evenement}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ARRAY{prix,#PRIX,id_declinaison,#ID_DECLINAISON}}}}
         ]
         #SET{id_prix_objet,#GET{id_prix_objet}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_PRIX_OBJET}}}
</BOUCLE_prix_art>
    #SET{prix,#GET{prix_evenement}} 
 </B_prix_art>
    
<BOUCLE_lieu_art(GIS){id_article}{si #GET{lieu}|count|<{1}} {0,1}>
    #SET{id_gis,#GET{id_gis}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_GIS}}}   
    #SET{lieu,#GET{lieu}|array_merge{#ARRAY{
        #COMPTEUR_BOUCLE,#ARRAY{
                titre,#TITRE,
                adresse,#ADRESSE**,
                code_postal,#CODE_POSTAL,
                ville,#VILLE
                }
              }
           }
       }        
</BOUCLE_lieu_art>


<B_date_resultat>
[(#ENV{script}|!={non}|oui)
<script type="text/javascript">
    $(document).ready(function(){
        $('ul.multi').click(function(){
            $(this).toggleClass('open').attr('title',$(this).attr('title') == '<:larut:fermer:>' ? '<:larut:voir_tous_cours:>' : '<:larut:fermer:>');                        
        });  
    });
</script>]
<B_date_resultat>
<aside class="details_cours">
<BOUCLE_date_resultat(DATA){source tableau,#GET{id_evenement}}>
#SET{compteur,#COMPTEUR_BOUCLE}   
#SET{cacher,''}
#SET{id_evenement,#VALEUR}       
            <B_evs_enfant>
            <div class="infos_cour">
                [(#TOTAL_BOUCLE|>{3}|oui)
                #SET{cacher,'invisible'}
                ]
                    <table> 
                        <tbody> 
                        <tr>
                            <td class="label"><:reservation:label_date:></td>
                            <td>
                                <ul[(#GET{cacher}|oui) class="multi" title="<:larut:voir_tous_cours:>"]>                                             
                                 <BOUCLE_evs_enfant(DATA){source tableau,#GET{dates_#VALEUR}}{si #GET{dates_#VALEUR}|count|>{1}|oui}>
                                    [(#ID_SOURCE|=={0}|oui)
								      #SET{evenements,#GET{id_evenement}}
								      #SET{horaire,#HORAIRE}
								      #SET{places,#PLACES}
								      ]
				                    #SET{separateur,''}
                                    [(#TOTAL_BOUCLE|>{3}|oui)                                    
                                    #SET{cacher,'cache'}
                                    [(#COMPTEUR_BOUCLE|=={1}|oui)#SET{cacher,''}]
                                     [(#COMPTEUR_BOUCLE|=={#TOTAL_BOUCLE}|oui)#SET{cacher,''}#SET{separateur,'<span>-</span>'}]  
                                    ]
                                	 
                                     <li class="date[ (#GET{cacher})]">#GET{separateur}[(#DATE_DEBUT|affdate_jourcourt)][(#GET{separateur}|oui) <span class="total_cours">([(#TOTAL_BOUCLE)] <:larut:cours:>)</span>]</li>      
                                 </BOUCLE_evs_enfant>            
                                </ul>   
                            </td>
                        </tr> 
                        <INCLURE{fond=inclure/details_cours_article_horaire,horaire=#GET{horaire}}/>
                        <INCLURE{fond=inclure/details_cours_article_prix,prix=#GET{prix}}/>
                        <INCLURE{fond=inclure/details_cours_article_lieu,lieu=#GET{lieu}}/>
	                    [(#GET{places}|>{0}|oui)
								<INCLURE{fond=inclure/details_cours_article_places_dispos,
									id_evenement=#GET{id_evenement},
									places=#GET{places},
									statut=#VAL|statuts_complet}/>]
                        </tbody>                                                       
                    </table>
                    <a class="btn btn-primary" href="[(#ENV{url_reservation}|parametre_url{id_evenement,#GET{evenements}})]"><i class="icon-arrow-right icon-white"></i> <:larut:inscription:></a>
                </div>
               </B_evs_enfant>
               <div class="infos_cour">
                <table> 
                    <tbody> 
                    <tr>
                        <td class="label"><:reservation:label_date:></td>
                        <td>              
                               <BOUCLE_evs_enfant_alt(DATA){source tableau,#GET{dates_#VALEUR}}>
                                [<div class="entete">(#DATE_DEBUT|affdate_debut_fin{#DATE_FIN,non})</div>]
                                #SET{horaire,#HORAIRE}#SET{places,#PLACES}
                               </BOUCLE_evs_enfant_alt>
                        </td>
                    </tr>   [(#GET{dates_#VALEUR}|table_valeur{horaire})]                      
                    <INCLURE{fond=inclure/details_cours_article_horaire,horaire=#GET{horaire}}/>
                    <INCLURE{fond=inclure/details_cours_article_prix,prix=#GET{prix}}/>
                    <INCLURE{fond=inclure/details_cours_article_lieu,lieu=#GET{lieu}}/>
                     [(#GET{places}|>{0}|oui)
							<INCLURE{fond=inclure/details_cours_article_places_dispos,
								id_evenement=#GET{id_evenement},
								places=#GET{places},
								statut=#VAL|statuts_complet}/>]
                   </tbody>                                             
                </table> 
               <a class="btn btn-primary" href="[(#ENV{url_reservation}|parametre_url{id_evenement,#GET{id_evenement}})]"><i class="icon-arrow-right icon-white"></i> <:larut:inscription:></a> 
            </div>  
            <//B_evs_enfant>                             
</BOUCLE_date_resultat>
</aside>
</B_date_resultat>
